<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<style>
  * {
    margin: 0;
    padding: 0;
  }
  .wrap {
    min-width: 500px;
  }

  .content {
    width: 100%;
    height: 500px;
    border: 1px solid black;
    overflow: hidden;
    display: flex;
  }
  .left, .right {
    width: 200px;
    height: 100%;
    background-color: red;
  }
  .middle {
    flex: 1;
    background-color: rosybrown;
  }

  .bfc {
    width: 100px;
    height: 100px;
    background-color: aqua;
    margin-bottom: 30px;
  }
  .bfc1 {
    width: 100px;
    height: 100px;
    background-color: red;
    margin-top: 20px;
  }


</style>

<body>
  <div class="wrap">
    <div class="content">
      <div class="left">left</div>
        <div class="middle">middle
        </div>
      <div class="right">right</div>
    </div>
  </div>
  <div id="root">
    {{ msg }}
  </div>

  <div class="bfc"></div>
  <div style="overflow: hidden;">
    <div class="bfc1"></div>
  </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<!-- <script type="text/javascript" src="./index.js"></script> -->
<script>

// Function.prototype.mybind = function(context, arr) {
//   var self = this,
//   args = Array.prototype.slice.call(arguments);
//   return function () {
//     self.apply(this instanceof self 
//       ? this : context,
//       args.concat(Array.prototype.slice.call(arguments)));
//   }
// }
// Function.prototype.mybind = function(context) {
//   var self = this;
//   var fNOP = function () { };
//   var aArgs = Array.prototype.slice.call(arguments, 1)
//   console.log(...arguments)
//   var fbound = function () {
//     self.apply(this instanceof self 
//       ? this : context,
//       aArgs.concat(Array.prototype.slice.call(arguments)));
//   }

//   fNOP.prototype = this.prototype;
//   fbound.prototype = new fNOP();
//   return fbound;
// }
// var aa = 23;
// var obj = {
//   aa: 123
// }

// function test () {
//   console.log(this.aa)
// }
// test()
// test.mybind(obj)()
// test()
  // el.onmousemove = function () {
  //   // console.log('sss')
  //   debounce(test, 3000)()
  // }

  
  // function ttrot(func, wait) {
  //   var timeDate = 0;
  //   var timer = null;
  //   return function () {
  //     var context = this;
  //     var args = arguments;
  //     // var now = Date.now();
  //     // if(now - timeDate > wait) {
  //     //   func.apply(context, args)
  //     //   timeDate = now
  //     // }
  //     timer = setTimeout(() => {
  //       timer = null;
  //       func.apply(context, args)
  //     }, wait)
  //   }
  // }

  async function fn1(next){
    console.log('fn1');
    await next(true)
    console.log('fn11')
  }
  async function fn2(next) {
    console.log('fn2');
    await delay(3000)
    await next(false)
    console.log('fn22')
  }
  async function fn3(next) {
    console.log('fn3')
  }

  function delay(wait) {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        resolve()
      }, wait)
    })
  }

  /**
   * 递归加函数组合compose
  */
  function compose(middlewares) {
    return function (...args) {
      // 执行第一个next
      return dispatch(0)

      function dispatch(i) {
        let fn = middlewares[i];
        if(!fn) {
          return Promise.resolve()
        }
        return Promise.resolve(
          fn(function next(bool) {
            // console.log(bool)
            return dispatch(i+1)

            // if(bool) {
            //   return dispatch(i+1)
            // } else {
            //   setTimeout(() => {
            //     return dispatch(i+1)
            //   })
            // }
          })
        )
      }
    }
  }

  const middlewares = [fn1, fn2, fn3];
  const finalFn = compose(middlewares);
  finalFn()



  



</script>

</html>